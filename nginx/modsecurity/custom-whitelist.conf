# ======================================================================
# Custom Whitelist Rules for Static Assets and Common Requests
# ======================================================================

# Whitelist static assets (images, CSS, JS, fonts, etc.)
SecRule REQUEST_FILENAME "@rx \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|map|pdf|txt|xml|json)$" \
    "id:1001,\
     phase:1,\
     pass,\
     t:lowercase,\
     msg:'Whitelisting static assets',\
     tag:'WHITELIST_STATIC',\
     ctl:ruleRemoveById=920100-999999"

# Whitelist common browser requests
SecRule REQUEST_URI "@rx ^/(favicon\.ico|robots\.txt|sitemap\.xml|manifest\.json|apple-touch-icon.*\.png)$" \
    "id:1002,\
     phase:1,\
     pass,\
     t:lowercase,\
     msg:'Whitelisting common browser requests',\
     tag:'WHITELIST_BROWSER',\
     ctl:ruleRemoveById=920100-999999"

# Whitelist API health checks and monitoring
SecRule REQUEST_URI "@rx ^/(health|status|ping|metrics|ready|live)/?$" \
    "id:1003,\
     phase:1,\
     pass,\
     t:lowercase,\
     msg:'Whitelisting health check endpoints',\
     tag:'WHITELIST_HEALTH',\
     ctl:ruleRemoveById=920100-999999"

# Whitelist frontend assets directory
SecRule REQUEST_URI "@rx ^/(_next/|assets/|static/|public/)" \
    "id:1004,\
     phase:1,\
     pass,\
     t:lowercase,\
     msg:'Whitelisting frontend asset directories',\
     tag:'WHITELIST_ASSETS',\
     ctl:ruleRemoveById=920100-999999"